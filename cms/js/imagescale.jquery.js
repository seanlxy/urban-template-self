(function(a){a.fn.imagescale=function(f){f=a.extend({parent:false,scale:"fill",center:true,fade:0,dontenlarge:false},f);var i,e,j,k,c,d,h,b;this.each(function(){var l=a(this);var m=(!f.parent?l.parent():l.parents(f.parent));m.css({opacity:0,overflow:"hidden"});if(m.length>0){l.removeAttr("height").removeAttr("width");if(this.complete){g(l,m,false)}else{l.load(function(){g(l,m,true)})}}});function g(n,r,l){i=r.height();e=r.width();_parentRatio=i/e;j=n.height();k=n.width();if((j>i||k>e)&&!f.dontenlarge){_imgRatio=j/k;m()}else{q();p()}function m(){if(_parentRatio>=_imgRatio){o("p")}else{o("l")}}function o(s){switch(s){case"p":if(f.scale=="fit"){c=e;d=_imgRatio*e;n.attr("width",e)}else{d=i;c=_imgRatio*i;n.attr("height",i)}break;case"l":if(f.scale=="fit"){d=i;c=_imgRatio*i;n.attr("height",i)}else{c=e;d=_imgRatio*e;n.attr("width",e)}break}if(f.center){q()}p()}function q(){c=n.width();d=n.height();if(d>i){b="-"+(Math.floor((d-i)/2))+"px";n.css({"margin-top":b})}else{b=(Math.floor((i-d)/2))+"px";n.css({"margin-top":b})}if(c>e){h="-"+(Math.floor((c-e)/2))+"px";n.css({"margin-left":h})}else{h=(Math.floor((e-c)/2))+"px";n.css({"margin-left":h})}}function p(){r.css("display","none");n.css({display:"block"});if(f.fade>0&&l){r.css({opacity:0,display:"block"}).animate({opacity:1},f.fade)}else{r.css({display:"block",opacity:1})}}}}})(jQuery);